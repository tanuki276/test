<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Tomato Man</title>
  <style>
    body { 
      font-family: sans-serif;
      padding: 20px; 
      background: #f4f4f4; 
    }
    textarea { 
      width: 100%; 
      height: 80px; 
      margin-bottom: 10px; 
      font-size: 1.2em;
      padding: 5px;
    }
    button { 
      padding: 10px 20px; 
      font-size: 1em; 
      margin-right: 10px;
      cursor: pointer;
    }
    #output { 
      font-size: 1.4em; 
      background: #fff; 
      padding: 10px; 
      border: 1px solid #ccc; 
      white-space: pre-wrap;
      margin-top: 20px;
      min-height: 50px;
    }
  </style>
</head>
<body>
  <h2>Tomato Man</h2>
  <p>ひらがなまたはコードを入力して、変換・逆変換してください。</p>
  <textarea id="input" placeholder="ここにひらがなかコードを入力"></textarea><br />
  <button onclick="encode()">変換（ひらがな→コード）</button>
  <button onclick="decode()">逆変換（コード→ひらがな）</button>
  <div id="output"></div>

  <script>
    // 独自コード体系対応マップ
    // 母音は数字、子音は英字、拗音はq＋子音＋数字
    // コードは長さにばらつきを持たせ、デコード時の識別を容易にする

    // ひらがな→コードマップ
    const kanaToCodeMap = {
      // 母音単独 (3桁の数字)
      'あ':'064','い':'372','う':'034','え':'769','お':'425',
      'ぁ':'06','ぃ':'37','ぅ':'03','ぇ':'76','ぉ':'42', // 小さい文字

      // 子音＋母音 (英字1文字 + 数字2桁/3桁)
      'か':'k01','き':'k02','く':'k03','け':'k04','こ':'k05',
      'さ':'s01','し':'s02','す':'s03','せ':'s04','そ':'s05',
      'た':'t01','ち':'t02','つ':'t03','て':'t04','と':'t05',
      'な':'n01','に':'n02','ぬ':'n03','ね':'n04','の':'n05',
      'は':'h01','ひ':'h02','ふ':'h03','へ':'h04','ほ':'h05',
      'ま':'m01','み':'m02','む':'m03','め':'m04','も':'m05',
      'や':'y01','ゆ':'y02','よ':'y03', // やゆよは子音にYを設定
      'ら':'r01','り':'r02','る':'r03','れ':'r04','ろ':'r05',
      'わ':'w01','を':'w02','ん':'x01', // んはx01
      
      // 濁音 (子音アルファベット+g+数字)
      'が':'kg01','ぎ':'kg02','ぐ':'kg03','げ':'kg04','ご':'kg05',
      'ざ':'zg01','じ':'zg02','ず':'zg03','ぜ':'zg04','ぞ':'zg05',
      'だ':'dg01','ぢ':'dg02','づ':'dg03','で':'dg04','ど':'dg05',
      'ば':'bg01','び':'bg02','ぶ':'bg03','べ':'bg04','ぼ':'bg05',

      // 半濁音 (子音アルファベット+p+数字)
      'ぱ':'pg01','ぴ':'pg02','ぷ':'pg03','ぺ':'pg04','ぽ':'pg05',

      // 拗音 (q + 子音 + 数字2桁/3桁) - デコード時に最長一致を優先するため、数字部分を調整
      'きゃ':'q_k01','きゅ':'q_k02','きょ':'q_k03',
      'しゃ':'q_s01','しゅ':'q_s02','しょ':'q_s03',
      'ちゃ':'q_t01','ちゅ':'q_t02','ちょ':'q_t03',
      'にゃ':'q_n01','にゅ':'q_n02','にょ':'q_n03',
      'ひゃ':'q_h01','ひゅ':'q_h02','ひょ':'q_h03',
      'みゃ':'q_m01','みゅ':'q_m02','みょ':'q_m03',
      'りゃ':'q_r01','りゅ':'q_r02','りょ':'q_r03',

      // 拗濁音 (q + 子音 + g + 数字2桁/3桁)
      'ぎゃ':'q_kg01','ぎゅ':'q_kg02','ぎょ':'q_kg03',
      'じゃ':'q_zg01','じゅ':'q_zg02','じょ':'q_zg03',
      'ぢゃ':'q_dg01','ぢゅ':'q_dg02','ぢょ':'q_dg03',
      'びゃ':'q_bg01','びゅ':'q_bg02','びょ':'q_bg03',

      // 拗半濁音 (q + 子音 + p + 数字2桁/3桁)
      'ぴゃ':'q_pg01','ぴゅ':'q_pg02','ぴょ':'q_pg03',

      // 促音・長音・空白・句読点など
      'っ':'tsu','ー':'chouon',' ':'space','、':'kuten','。':'maru',
      '？':'question','！':'exclamation',
      // その他、マップにない文字はそのまま出力されるか、エラーハンドリングが必要
    };

    // コード→ひらがなマップ（自動生成）
    const codeToKanaMap = {};
    for (const [kana, code] of Object.entries(kanaToCodeMap)) {
      codeToKanaMap[code] = kana;
    }

    // デコード時のトークン分割用正規表現
    // 長いコード（q_子音+g+数字、q_子音+数字）から短いコード（英字+数字、数字）の順にマッチさせる
    // 各トークンのルールに合わせて細かく指定
    const tokenRegex = new RegExp(
        Object.values(kanaToCodeMap)
              .sort((a, b) => b.length - a.length) // 長いコードから順にマッチさせるためソート
              .map(code => code.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')) // 正規表現特殊文字をエスケープ
              .join('|'),
        'g'
    );

    // エンコード：ひらがな→コード
    function encode() {
      let input = document.getElementById('input').value.trim();
      let output = '';
      
      // 最長一致で置換するために、キーを長さの降順でソート
      // (例: 'きゅ'を'き'より先にマッチさせる)
      const sortedKanaKeys = Object.keys(kanaToCodeMap).sort((a, b) => b.length - a.length);

      let tempInput = input; // 置換処理用のテンポラリ変数
      for (const kana of sortedKanaKeys) {
        // 正規表現を使ってグローバルに置換
        // kanaが正規表現の特殊文字を含む可能性があるのでエスケープ
        tempInput = tempInput.replace(new RegExp(kana.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), kanaToCodeMap[kana]);
      }
      
      output = tempInput; // 全置換後の文字列をセット

      document.getElementById('output').textContent = output;
    }

    // デコード：コード→ひらがな
    function decode() {
      let input = document.getElementById('input').value.trim();
      let output = '';
      
      // input.match(tokenRegex) で、定義されたコードのトークンに分割
      const tokens = input.match(tokenRegex) || [];

      for(const token of tokens){
        if(codeToKanaMap[token]){
          output += codeToKanaMap[token];
        } else {
          // マップにない未知のコードの場合、そのまま表示
          output += `[${token}]`; 
        }
      }

      document.getElementById('output').textContent = output;
    }
  </script>
</body>
</html>
